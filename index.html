<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O디지털 디톡스</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'SUIT', sans-serif;
            background:#f0f0f0; color:#000; overflow-x:hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23000" d="M12 2c.552 0 1 .448 1 1v7.086l1.293-1.293a1 1 0 1 1 1.414 1.414l-3.004 3.004a1.5 1.5 0 0 1-2.121 0L7.578 10.5a1 1 0 1 1 1.414-1.414L10 10.094V3c0-.552.448-1 1-1z"/></svg>') 8 2, pointer;
        }

        .sidebar{ position:fixed; top:0; left:0; bottom:0; width:240px; background:#e0e0e0; border-right:3px solid #333; z-index:60; 
            padding:16px 12px; display:flex; flex-direction:column; gap:12px; pointer-events:none; }
        .sidebar .brand{ font-weight:800; font-size:20px; padding:8px 10px; pointer-events:auto; font-family:'Courier New', monospace; }
        .menu{ display:flex; flex-direction:column; gap:6px; margin-top:8px; }
        .menu a{ display:flex; align-items:center; gap:12px; padding:10px 12px; color:#000; text-decoration:none; font-weight:600; 
            border:2px solid #333; margin:2px 0; pointer-events:auto; }
        .menu a:hover{ background:#ccc; }
        .sidebar .spacer{ flex:1; }


        .explore-header, .explore-section{ margin-left:240px; }


        @media (max-width:1024px){ .sidebar{ width:72px; padding:16px 8px; } .menu a span.label{ display:none; } .explore-header, 
        .explore-section{ margin-left:72px; } }



        
        .main-container{ position:relative; min-height:200vh; z-index:1; }

        
        .explore-header{ position:fixed; top:0; left:0; width:100%; background:#000; border-bottom:3px solid #333; padding:20px 0; z-index:100; 
            transition:all .3s ease; }
        .explore-header.glitch{ animation:glitch .3s infinite; }
        @keyframes glitch{ 0%{transform:translateX(0)} 20%{transform:translateX(-2px)} 40%{transform:translateX(2px)} 
        60%{transform:translateX(-1px)} 80%{transform:translateX(1px)} 100%{transform:translateX(0)} }
        .header-content{ max-width:1200px; margin:0 auto; padding:0 20px; display:flex; justify-content:space-between; align-items:center; }
        .logo{ font-size:2rem; font-weight:bold; color:#e50914; }
        .nav-menu{ display:flex; gap:30px; list-style:none; }
        .nav-menu a{ color:#fff; text-decoration:none; font-size:1.1rem; transition:color .3s ease; }
        .nav-menu a:hover{ color:#e50914; }

        
        .explore-header{ position:sticky; top:0; background:#fff; z-index:50; border-bottom:1px solid rgba(0,0,0,.08); }
        .explore-inner{ max-width:1200px; margin:0 auto; padding:12px; display:flex; gap:12px; align-items:center; }
        .brand{ font-weight:800; letter-spacing:.5px; font-family:'Courier New', monospace; }
        .search{ flex:1; background:#fff; color:#000; border:2px solid #333; padding:10px 12px; }

        .explore-section{ padding:12px; max-width:1200px; margin:0 auto; background:#f0f0f0; }
        .explore-grid{ display:grid; grid-template-columns:repeat(5,1fr); gap:2px; }
        
        
        .explore-grid .thumbnail{ min-width:auto; width:100%; position:relative; background:#fff; border:2px solid #333; }
        .explore-grid .thumbnail::before{ content:""; display:block; padding-top:100%; }
        
        .explore-grid .thumbnail.tall-2::before{ padding-top:200%; }
        .explore-grid .thumbnail > *{ position:absolute; inset:0; }
        
        .section-title{ font-size:1.5rem; margin-bottom:20px; color:#fff; }
        .thumbnail-row{ display:flex; gap:10px; margin-bottom:40px; overflow-x:auto; padding-bottom:10px; }

        .thumbnail{ min-width:200px; height:300px; background:linear-gradient(45deg,#333,#555); position:relative; 
            cursor:pointer; overflow:hidden; flex:0 0 auto; }

        
        .thumbnail.falling{ position:fixed; z-index:10; pointer-events:auto; opacity:1 !important; will-change:transform,top,left; }
        
        
        .cleaning-mode .thumbnail.falling{ pointer-events:auto; }

        
        .thumbnail.already-fallen{ visibility:hidden; }

        .thumbnail.destroyed{ animation:destroy .5s ease-out forwards; pointer-events:none; }
        
        .random-window{ position:fixed !important; width:300px !important; height:150px !important; background:#fff !important; 
            border:3px solid #000 !important; z-index:9999 !important; cursor:pointer; display:flex !important; align-items:center; justify-content:center; font-family:'SUIT',sans-serif; font-size:14px; color:#000 !important; opacity:1 !important; visibility:visible !important; }
        
        .close-button{ position:absolute !important; top:5px !important; right:5px !important; width:20px !important; height:20px 
            !important; background:#000 !important; border:2px solid #000 !important; border-radius:50% !important; color:#fff 
            !important; display:flex !important; align-items:center !important; justify-content:center !important; font-size:12px !important; font-weight:bold !important; cursor:pointer !important; z-index:10000 !important; }
        
        .close-button:hover{ background:#333 !important; }
        
       
        .cleaning-mode-switch{ position:fixed; bottom:20px; right:20px; z-index:10000; width:120px; height:120px; border-radius:50%;
             background:#fff; border:4px solid #000; display:flex; align-items:center; justify-content:center; font-family:'SUIT',sans-serif; font-size:14px; font-weight:bold; text-align:center; line-height:1.2; cursor:pointer; user-select:none; transition:all 0.3s ease; opacity:0; transform:translateY(20px) scale(0.8); }
        
        .cleaning-mode-switch.visible{ opacity:1; transform:translateY(0) scale(1); }
        
        .cleaning-mode-switch:hover{ background:#f0f0f0; transform:scale(1.1); }
        
        .cleaning-mode-switch.active{ background:#000; color:#fff; }
        
        .cleaning-mode-switch.active:hover{ transform:scale(1.1); }
        
        
        .detox-complete{ position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); font-size:4rem; font-weight:bold; 
            color:#000; text-align:center; z-index:20000; opacity:0; transition:opacity 1s ease; font-family:'SUIT',sans-serif;
             text-shadow:2px 2px 4px rgba(0,0,0,0.3); }
        
        .detox-complete.visible{ opacity:1; }
        
        .scroll-instruction{ position:fixed; font-size:0.69rem; font-weight:bold; color:#fff; text-align:center; z-index:15000; opacity:1; font-family:'SUIT',sans-serif; background:#000; border:2px solid #333; padding:7px 12px; border-radius:4px; box-shadow:0 2px 4px rgba(0,0,0,0.5); pointer-events:none; white-space:nowrap; }
        
        .brain-overload{ position:fixed; font-size:0.805rem; font-weight:bold; color:#fff; text-align:center; z-index:15000; opacity:1; font-family:'SUIT',sans-serif; background:#000; border:2px solid #333; padding:9px 14px; border-radius:4px; box-shadow:0 2px 4px rgba(0,0,0,0.5); pointer-events:none; min-width:414px; }
        .overload-label{ font-size:0.69rem; margin-bottom:5px; color:#ccc; }
        .progress-bar{ width:100%; height:9px; background:#333; border:1px solid #555; margin:5px 0; overflow:hidden; }
        .progress-fill{ height:100%; background:linear-gradient(90deg,#4CAF50,#FFC107,#FF5722); transition:width 0.3s ease; width:0%; }
        .overload-percentage{ font-size:0.805rem; font-weight:bold; color:#fff; margin-top:2px; }
        
        /* 클리닝 모드 커서 */
        body.cleaning-mode{ cursor:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" fill="none" stroke="%23000" stroke-width="2"/><rect x="6" y="6" width="12" height="12" fill="%23000"/></svg>') 12 12, auto; }
        
        
        .cleaning-mode .thumbnail, .cleaning-mode .thumbnail.falling, .cleaning-mode .random-window, .cleaning-mode .menu a, 
        .cleaning-mode .search, .cleaning-mode .brand{ transition:none; }
        
        
        .cleaning-mode .sidebar{ transition:opacity 0.5s ease; }
        
        .cleaning-mode .sidebar.cleaned{ opacity:0; }
        
        
        .search {
            transition: opacity 0.5s ease;
        }
        
        .search.cleaned {
            opacity: 0 !important;
        }
        
        
        @keyframes destroy{
            0%{ transform:scale(1) rotate(0deg); opacity:1; }
            50%{ transform:scale(1.1) rotate(10deg); opacity:.85; }
            100%{ transform:scale(.9) rotate(0deg); opacity:0; }
        }

        .thumbnail-content{
            position:absolute; inset:auto 0 0 0;
            padding:20px; color:#fff;
        }
        .thumbnail-title{ font-size:1rem; font-weight:bold; margin-bottom:5px; }
        .thumbnail-info{ font-size:.8rem; opacity:.8; }

        

        

        @media (max-width:768px){
            .thumbnail{ min-width:150px; height:225px; }
            .nav-menu{ gap:15px; }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="brand">Insta</div>
        <nav class="menu">
            <a href="#"><span class="label">홈</span></a>
            <a href="#"><span class="label">검색</span></a>
            <a href="#"><span class="label">탐색 탭</span></a>
            <a href="#"><span class="label">릴스</span></a>
            <a href="#"><span class="label">메시지</span></a>
            <a href="#"><span class="label">알림</span></a>
            <a href="#"><span class="label">만들기</span></a>
            <a href="#"><span class="label">프로필</span></a>
        </nav>
        <div class="spacer"></div>
    </aside>

    <header class="explore-header">
        <div class="explore-inner">
            <div class="brand">Explore</div>
            <input id="search" class="search" placeholder="검색" />
        </div>
    </header>

    <main class="explore-section">
        <div class="explore-grid" id="explore-grid"></div>
    </main>
    
    <div class="cleaning-mode-switch" id="cleaning-mode-switch">
        CLEANING<br>MODE
    </div>
    
    <div class="scroll-instruction" id="scroll-instruction">
        싹싹 청소해봅시다!
    </div>
    
    <div class="brain-overload" id="brain-overload">
        <div class="overload-label">뇌 과부화</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="overload-percentage"><span id="overload-percentage">0</span>%</div>
    </div>
    
    <div class="detox-complete" id="detox-complete">
        DETOX COMPLETE!
    </div>

    <script>
        const contentData = {
            'trending': [
                { title:'일상 사진', info:'라이프스타일', image:'1.jpg' },
                { title:'여행', info:'여행', image:'2.jpg' },
                { title:'음식', info:'푸드', image:'3.jpg' },
                { title:'패션', info:'패션', image:'4.jpg' },
                { title:'반려동물', info:'펫', image:'5.jpg' },
                { title:'운동', info:'피트니스', image:'6.jpg' },
                { title:'예술', info:'크리에이티브', image:'7.jpg' },
                { title:'음악', info:'멜로디', image:'8.jpg' },
                { title:'자연', info:'아웃도어', image:'9.jpg' },
                { title:'테크', info:'기술', image:'10.jpg' },
                { title:'건강', info:'웰빙', image:'11.jpg' },
                { title:'독서', info:'교육', image:'12.jpg' },
                { title:'게임', info:'엔터테인먼트', image:'13.jpg' },
                { title:'인테리어', info:'홈데코', image:'14.jpg' },
                { title:'자동차', info:'모터', image:'15.jpg' },
                { title:'스포츠', info:'경기', image:'16.jpg' },
                { title:'뷰티', info:'코스메틱', image:'17.jpg' },
                { title:'영화', info:'시네마', image:'18.jpg' },
                { title:'쇼핑', info:'리테일', image:'19.jpg' },
                { title:'요리', info:'레시피', image:'20.jpg' }
            ],
            'recommended': [
                { title:'자연', info:'풍경', image:'21.jpg' },
                { title:'건축', info:'건축', image:'22.jpg' },
                { title:'예술', info:'아트', image:'23.jpg' },
                { title:'스포츠', info:'운동', image:'24.jpg' },
                { title:'음악', info:'뮤직', image:'25.jpg' }
            ],
            'lifestyle': [
                { title:'인테리어', info:'홈', image:'26.jpg' },
                { title:'요리', info:'쿠킹', image:'27.jpg' },
                { title:'운동', info:'피트니스', image:'28.jpg' },
                { title:'독서', info:'북', image:'29.jpg' },
                { title:'게임', info:'게임', image:'30.jpg' }
            ],
            'nature': [
                { title:'바다', info:'오션', image:'31.jpg' },
                { title:'산', info:'마운틴', image:'32.jpg' },
                { title:'꽃', info:'플라워', image:'33.jpg' },
                { title:'하늘', info:'스카이', image:'34.jpg' },
                { title:'나무', info:'트리', image:'35.jpg' }
            ],
            'city': [
                { title:'도시', info:'시티', image:'36.jpg' },
                { title:'야경', info:'나이트', image:'37.jpg' },
                { title:'거리', info:'스트리트', image:'38.jpg' },
                { title:'카페', info:'카페', image:'39.jpg' },
                { title:'쇼핑', info:'쇼핑', image:'40.jpg' }
            ],
            'people': [
                { title:'인물', info:'포트레이트', image:'41.jpg' },
                { title:'친구', info:'프렌드', image:'42.jpg' },
                { title:'가족', info:'패밀리', image:'43.jpg' },
                { title:'커플', info:'커플', image:'44.jpg' },
                { title:'아이', info:'키즈', image:'45.jpg' }
            ],
            'tech': [
                { title:'테크', info:'기술', image:'46.jpg' },
                { title:'가젯', info:'가젯', image:'47.jpg' },
                { title:'코딩', info:'코딩', image:'48.jpg' },
                { title:'AI', info:'AI', image:'49.jpg' },
                { title:'로봇', info:'로봇', image:'50.jpg' }
            ],
            'creative': [
                { title:'디자인', info:'디자인', image:'51.jpg' },
                { title:'일러스트', info:'일러스트', image:'52.jpg' },
                { title:'사진', info:'포토', image:'53.jpg' },
                { title:'영상', info:'비디오', image:'54.jpg' },
                { title:'3D', info:'3D', image:'55.jpg' }
            ],
            'misc': [
                { title:'랜덤', info:'기타', image:'56.jpg' },
                { title:'추천', info:'추천', image:'57.jpg' },
                { title:'인기', info:'인기', image:'58.jpg' },
                { title:'신규', info:'신규', image:'59.jpg' },
                { title:'특별', info:'특별', image:'60.jpg' }
            ]
        };

        let scrollY = 0;
        let fallingThumbnails = [];
        let stackedThumbnails = [];
        let destroyedCount = 0;
        let totalThumbnails = 0;
        let isGlitching = false;
        let isCleaningMode = false;
        let cleaningModeStartPercent = 0;

        const GRAVITY = 0.5;
        const BOUNCE  = 0.08;
        const FRICTION = 0.95;
        const MIN_VELOCITY = 0.8;
        const MAX_SPEED = 10;
        const PILE_GROWTH = 0.12;
        const PILE_CAP    = 0.45;
        const SETTLE_X_JITTER = 8;
        let pileHeight = 0;

        function getLocalPileHeight(x, w){
            const xCenter = x + w/2;
            let h = 0;
            const OVERLAP_SLACK = 20;
            for(const s of stackedThumbnails){
                const sCenter = s.x + s.width/2;
                const dx = Math.abs(xCenter - sCenter);
                const halfSum = (w + s.width)/2;
                if(dx - OVERLAP_SLACK < halfSum){
                    h += s.height * PILE_GROWTH;
                }
            }
            const cap = window.innerHeight * PILE_CAP;
            return Math.min(cap, h);
        }

        function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

        function init(){
            createThumbnails();
            setupEventListeners();
            totalThumbnails = document.querySelectorAll('.thumbnail').length;
        }

        function createThumbnails(){
            const grid = document.getElementById('explore-grid');
            if(!grid) return;

            const pools = Object.values(contentData).flat();
            const TOTAL = 80;
            for(let i=0;i<TOTAL;i++){
                const item = pools[Math.floor(Math.random()*pools.length)];
                const t = document.createElement('div');
                t.className = 'thumbnail';
                const r = Math.random();
                if(r < 0.12) t.classList.add('tall-3');
                else if(r < 0.32) t.classList.add('tall-2');

                if(item.image) {
                    t.style.background = `url('${item.image}') center/cover`;
                } else {
                    t.style.background = `linear-gradient(45deg, ${item.color}, ${item.color}dd)`;
                }
                
                t.innerHTML = `
                    <div class="thumbnail-content">
                        <div class="thumbnail-title">${item.title}</div>
                        <div class="thumbnail-info">${item.info}</div>
                    </div>`;
                grid.appendChild(t);
            }
        }

        function setupEventListeners(){
            window.addEventListener('scroll', handleScroll);
            document.addEventListener('click', handleClick);
            window.addEventListener('resize', ()=>{});
            
            document.getElementById('cleaning-mode-switch').addEventListener('click', toggleCleaningMode);
            
            let instructionTargetX = 0, instructionTargetY = 0;
            let brainTargetX = 0, brainTargetY = 0;
            let instructionCurrentX = 0, instructionCurrentY = 0;
            let brainCurrentX = 0, brainCurrentY = 0;
            
            function animateElements() {
                const instructionElement = document.getElementById('scroll-instruction');
                const brainOverloadElement = document.getElementById('brain-overload');
                
                if (instructionElement && instructionElement.style.opacity !== '0') {
                    instructionCurrentX += (instructionTargetX - instructionCurrentX) * 0.1;
                    instructionCurrentY += (instructionTargetY - instructionCurrentY) * 0.1;
                    instructionElement.style.left = instructionCurrentX + 'px';
                    instructionElement.style.top = instructionCurrentY + 'px';
                }
                
                if (brainOverloadElement && brainOverloadElement.style.opacity !== '0') {
                    brainCurrentX += (brainTargetX - brainCurrentX) * 0.2;
                    brainCurrentY += (brainTargetY - brainCurrentY) * 0.2;
                    brainOverloadElement.style.left = brainCurrentX + 'px';
                    brainOverloadElement.style.top = brainCurrentY + 'px';
                }
                
                requestAnimationFrame(animateElements);
            }
            
            animateElements();
            
            document.addEventListener('mousemove', function(e) {
                window.mouseX = e.clientX;
                window.mouseY = e.clientY;
                
                const instructionElement = document.getElementById('scroll-instruction');
                const brainOverloadElement = document.getElementById('brain-overload');
                
                if (instructionElement && instructionElement.style.opacity !== '0') {
                    instructionTargetX = e.clientX + 15;
                    instructionTargetY = e.clientY + 50;
                }
                
                if (brainOverloadElement && brainOverloadElement.style.opacity !== '0') {
                    brainTargetX = e.clientX + 15;
                    brainTargetY = e.clientY - 30;
                }
            });
            
            document.addEventListener('mouseover', function(e) {
                if(isCleaningMode) {
                    const thumbnail = e.target.closest('.thumbnail');
                    const randomWindow = e.target.closest('.random-window');
                    const menuItem = e.target.closest('.menu a');
                    const searchInput = e.target.closest('.search');
                    const brandElement = e.target.closest('.brand');
                    
                    if(thumbnail && !thumbnail.classList.contains('destroyed')) {
                        cleanElement(thumbnail);
                    } else if(randomWindow) {
                        cleanElement(randomWindow);
                    } else if(menuItem && !menuItem.classList.contains('cleaned')) {
                        cleanElement(menuItem);
                    } else if(searchInput && !searchInput.classList.contains('cleaned')) {
                        cleanElement(searchInput);
                    } else if(brandElement && !brandElement.classList.contains('cleaned')) {
                        cleanElement(brandElement);
                    }
                }
            });
            
            document.addEventListener('mouseover', function(e) {
                if(isCleaningMode) {
                    const exploreHeader = e.target.closest('.explore-header');
                    const searchInput = document.querySelector('.search');
                    
                    if(exploreHeader && searchInput && !searchInput.classList.contains('cleaned')) {
                        cleanElement(searchInput);
                    }
                }
            });
        }

        let lastScrollTime = 0;
        let lastScrollY = 0;
        const SCROLL_SLOWDOWN = 0.2;
        function handleScroll(){
            const now = Date.now();
            if(now - lastScrollTime < 250) return;
            lastScrollTime = now;

            scrollY = window.scrollY;

            const scrollingDown = scrollY > lastScrollY;
            lastScrollY = scrollY;

            if(scrollingDown && scrollY > 100) startGravityAnimation();
            if(scrollY > 500 && !isGlitching) startGlitchEffect();
            
            if(scrollingDown && scrollY > 200 && Math.random() < 0.3) createRandomWindow();
            
            updateCleaningSwitchVisibility();
        }

        window.addEventListener('wheel', (e)=>{
            if(e.ctrlKey || e.shiftKey || e.altKey || e.metaKey) return;
            e.preventDefault();
            window.scrollBy({ top: e.deltaY * SCROLL_SLOWDOWN, behavior: 'auto' });
        }, { passive:false });

        function startGravityAnimation(){
            const candidates = document.querySelectorAll('.thumbnail:not(.falling):not(.destroyed):not(.already-fallen)');
            const visible = Array.from(candidates).filter(t=>{
                const r = t.getBoundingClientRect();
                return r.top < window.innerHeight && r.bottom > 0;
            });
            
            const hidden = Array.from(candidates).filter(t=>{
                const r = t.getBoundingClientRect();
                return r.bottom <= 0;
            });
            
            hidden.forEach(th => {
                th.classList.add('already-fallen');
                th.style.visibility = 'hidden';
            });

            const batch = Math.min(1, Math.ceil(visible.length * 0.03));
            let count = 0;

            visible.forEach(th=>{
                if(count >= batch) return;
                if(Math.random() < 0.25){
                    makeThumbnailFall(th);
                    th.classList.add('already-fallen');
                    count++;
                }
            });
        }

        function makeThumbnailFall(original){
            const rect = original.getBoundingClientRect();
            const clone = original.cloneNode(true);
            clone.classList.add('falling');

            const width = rect.width;
            const height = rect.height;
            const x = rect.left;
            const y = rect.top;

            const cs = getComputedStyle(original);
            Object.assign(clone.style, {
                position: 'fixed',
                left: x + 'px',
                top: y + 'px',
                width: width + 'px',
                height: height + 'px',
                zIndex: '10',
                pointerEvents: isCleaningMode ? 'auto' : 'none',
                opacity: '1',
                background: cs.background || original.style.background,
                border: '2px solid #333',
                transform: 'translateZ(0)'
            });

            document.body.appendChild(clone);

            const obj = {
                element: clone,
                width, height,
                x, y,
                velocityX: (Math.random()*2 - 1) * 2.5,
                velocityY: 3.0,
                rotation: 0,
                rotationSpeed: 0,
                isStacked: false,
                rollBias: (Math.random() < 0.5 ? -1 : 1) * (1.0 + Math.random()*0.8)
            };
            fallingThumbnails.push(obj);
            
            makeDraggable(clone);
        }

        function handleClick(e){
            
            if(isCleaningMode) return;
            
            const th = e.target.closest('.thumbnail');
            if(!th) return;
            if(th.classList.contains('destroyed')) return;
            createRandomWindow();
            
            // 썸네일 클릭 시 과부화 수치 1% 증가
            const overloadPercentage = document.getElementById('overload-percentage');
            const progressFill = document.getElementById('progress-fill');
            if (overloadPercentage && progressFill) {
                let currentPercent = parseInt(overloadPercentage.textContent) || 0;
                currentPercent = Math.min(100, currentPercent + 1);
                overloadPercentage.textContent = currentPercent;
                progressFill.style.width = currentPercent + '%';
            }
        }

        function createRandomWindow(){
            const win = document.createElement('div');
            win.className = 'random-window';
            const w = 320, h = 180;
            const x = Math.random() * (window.innerWidth - w);
            const y = Math.random() * (window.innerHeight - h);
            
            win.style.cssText = `position:fixed!important;left:${x}px!important;top:${y}px!important;width:${w}px!important;height:${h}px!important;background:#fff!important;border:3px solid #000!important;z-index:9999!important;display:flex!important;align-items:center!important;justify-content:center!important;font-family:'SUIT',sans-serif!important;font-size:14px!important;color:#000!important;opacity:1!important;visibility:visible!important;cursor:move!important;`;
            win.textContent = '동영상 영역';
            
            const btn = document.createElement('div');
            btn.className = 'close-button';
            btn.textContent = '×';
            btn.onclick = function(e) {
                e.stopPropagation();
                win.remove();
                
                // 팝업 닫을 시 과부화 수치 1% 하락
                const overloadPercentage = document.getElementById('overload-percentage');
                const progressFill = document.getElementById('progress-fill');
                if (overloadPercentage && progressFill) {
                    let currentPercent = parseInt(overloadPercentage.textContent) || 0;
                    currentPercent = Math.max(0, currentPercent - 1);
                    overloadPercentage.textContent = currentPercent;
                    progressFill.style.width = currentPercent + '%';
                }
                
                setTimeout(checkDetoxComplete, 0);
            };
            
            win.appendChild(btn);
            makeDraggable(win);
            document.body.appendChild(win);
        }
        
        function makeDraggable(element) {
            let isDragging = false;
            let startX;
            let startY;
            let initialX;
            let initialY;
            
            element.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            function dragStart(e) {
                if (e.target.classList.contains('close-button')) {
                    return;
                }
                
                isDragging = true;
                
                initialX = parseInt(element.style.left) || 0;
                initialY = parseInt(element.style.top) || 0;
                
                startX = e.clientX;
                startY = e.clientY;
                
                e.preventDefault();
            }
            
            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    const newX = initialX + deltaX;
                    const newY = initialY + deltaY;
                    
                    element.style.left = newX + 'px';
                    element.style.top = newY + 'px';
                }
            }
            
            function dragEnd(e) {
                isDragging = false;
            }
        }

        function startGlitchEffect(){
            isGlitching = true;
            document.querySelector('.explore-header').classList.add('glitch');
            setTimeout(()=>{
                document.querySelector('.explore-header').classList.remove('glitch');
                isGlitching = false;
            }, 1000);
        }
        
        function updateCleaningSwitchVisibility() {
            const switchElement = document.getElementById('cleaning-mode-switch');
            const instructionElement = document.getElementById('scroll-instruction');
            const brainOverloadElement = document.getElementById('brain-overload');
            const overloadPercentage = document.getElementById('overload-percentage');
            if (!switchElement || !instructionElement || !brainOverloadElement || !overloadPercentage) return;
            
            const docHeight = Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight);
            const winHeight = window.innerHeight;
            const maxScroll = docHeight - winHeight;
            const progress = Math.min(scrollY / maxScroll, 1);
            
            let overloadPercent;
            if (isCleaningMode) {
                const originalThumbnails = document.querySelectorAll('.explore-grid .thumbnail');
                const cleanedThumbnails = Array.from(originalThumbnails).filter(thumb => 
                    thumb.classList.contains('destroyed') || 
                    thumb.classList.contains('already-fallen') || 
                    thumb.style.visibility === 'hidden'
                );
                const thumbnailPercentage = originalThumbnails.length > 0 ? 
                    (cleanedThumbnails.length / originalThumbnails.length) * 100 : 100;
                
                // 기준선에서 청소한 비율만큼 감소
                const cleaningProgress = thumbnailPercentage / 100; // 0~1
                overloadPercent = Math.round(cleaningModeStartPercent * (1 - cleaningProgress));
            } else {
                // 스크롤 모드에서는 현재 과부화 수치 유지 (감소하지 않음)
                const currentPercent = parseInt(document.getElementById('overload-percentage').textContent) || 0;
                overloadPercent = Math.max(currentPercent, Math.round(progress * 100));
            }
            
            overloadPercentage.textContent = overloadPercent;
            
            const progressFill = document.getElementById('progress-fill');
            if (progressFill) {
                progressFill.style.width = overloadPercent + '%';
            }
            
            if (scrollY > 0) {
                switchElement.classList.add('visible');
                switchElement.style.opacity = Math.max(0.1, progress);
                if (progress >= 0.95) {
                    switchElement.classList.add('active');
                    switchElement.style.backgroundColor = '#ff4444';
                    switchElement.style.color = '#fff';
                    instructionElement.textContent = isCleaningMode ? '싹싹 청소해봅시다!' : '스크롤을 끝까지 내려주세요';
                    instructionElement.style.opacity = '1';
                    brainOverloadElement.style.opacity = '1';
                } else {
                    switchElement.classList.remove('active');
                    switchElement.style.backgroundColor = '#333';
                    switchElement.style.color = '#fff';
                    instructionElement.textContent = isCleaningMode ? '싹싹 청소해봅시다!' : '스크롤을 끝까지 내려주세요';
                    instructionElement.style.opacity = '1';
                    brainOverloadElement.style.opacity = '1';
                }
            } else {
                switchElement.classList.remove('visible');
                switchElement.classList.remove('active');
                switchElement.style.backgroundColor = '#333';
                switchElement.style.color = '#fff';
                instructionElement.textContent = isCleaningMode ? '싹싹 청소해봅시다!' : '스크롤을 끝까지 내려주세요';
                instructionElement.style.opacity = '1';
                brainOverloadElement.style.opacity = '1';
            }
        }
        
        function toggleCleaningMode() {
            const docHeight = Math.max(document.body.scrollHeight, document.body.offsetHeight, document.documentElement.clientHeight, document.documentElement.scrollHeight, document.documentElement.offsetHeight);
            const winHeight = window.innerHeight;
            const maxScroll = docHeight - winHeight;
            const progress = Math.min(scrollY / maxScroll, 1);
            console.log('클리닝 모드 클릭 - progress:', progress, 'scrollY:', scrollY, 'maxScroll:', maxScroll);
            if (progress < 0.95) {
                console.log('클리닝 모드 클릭 차단됨 - 95% 미만');
                return;
            }
            
            isCleaningMode = !isCleaningMode;
            const switchElement = document.getElementById('cleaning-mode-switch');
            const body = document.body;
            
            if(isCleaningMode) {
                switchElement.classList.add('active');
                switchElement.classList.remove('inactive');
                body.classList.add('cleaning-mode');
                switchElement.innerHTML = 'CLEANING<br>MODE ON';
                switchElement.style.backgroundColor = '#ff4444';
                switchElement.style.color = '#fff';
                
                // 클리닝 모드 시작 시점의 과부화 수치를 기준선으로 설정
                const currentPercent = parseInt(document.getElementById('overload-percentage').textContent) || 0;
                cleaningModeStartPercent = currentPercent;
                
                const instructionElement = document.getElementById('scroll-instruction');
                const brainOverloadElement = document.getElementById('brain-overload');
                if(instructionElement) {
                    instructionElement.textContent = '싹싹 청소해봅시다!';
                    instructionElement.style.opacity = '1';
                }
                if(brainOverloadElement) brainOverloadElement.style.opacity = '1';
                
                document.querySelectorAll('.thumbnail.falling').forEach(fallingThumbnail => {
                    fallingThumbnail.style.pointerEvents = 'auto';
                });
            } else {
                switchElement.classList.remove('active');
                switchElement.classList.add('inactive');
                body.classList.remove('cleaning-mode');
                switchElement.innerHTML = 'CLEANING<br>MODE';
                switchElement.style.backgroundColor = '#666';
                switchElement.style.color = '#ccc';
                
                const instructionElement = document.getElementById('scroll-instruction');
                const brainOverloadElement = document.getElementById('brain-overload');
                if(instructionElement) {
                    instructionElement.textContent = '스크롤을 끝까지 내려주세요';
                    instructionElement.style.opacity = '1';
                }
                if(brainOverloadElement) brainOverloadElement.style.opacity = '1';
                
                document.querySelectorAll('.thumbnail.falling').forEach(fallingThumbnail => {
                    fallingThumbnail.style.pointerEvents = 'none';
                });
            }
        }
        
        function cleanElement(element) {
            if(element.classList.contains('thumbnail')) {
                if(element.classList.contains('falling')) {
                    fallingThumbnails = fallingThumbnails.filter(obj => obj.element !== element);
                }
                element.classList.add('destroyed');
                destroyedCount++;
            } else if(element.tagName === 'A' && element.closest('.menu')) {
                element.classList.add('cleaned');
                
                setTimeout(() => {
                    checkSidebarVisibility();
                }, 100);
            } else if(element.classList.contains('search')) {
                console.log('검색창 클리닝:', element);
                element.classList.add('cleaned');
                console.log('검색창 cleaned 클래스 추가됨:', element.classList.contains('cleaned'));
                return;
            } else if(element.classList.contains('brand') && element.closest('.sidebar')) {
                element.classList.add('cleaned');
                
                setTimeout(() => {
                    checkSidebarVisibility();
                }, 100);
            } else if(element.classList.contains('sidebar')) {
                element.classList.add('cleaned');
                return;
            } else if(element.classList.contains('random-window')) {
                element.classList.add('cleaned');
            }
            
            element.style.setProperty('visibility', 'hidden', 'important');
            element.style.pointerEvents = 'none';
            
            createGhostAndAnimate(element);
            
            setTimeout(() => {
                checkDetoxComplete();
                // 클리닝 모드에서 썸네일 지울 때 과부화 수치 즉시 업데이트
                if (isCleaningMode && element.classList.contains('thumbnail')) {
                    const originalThumbnails = document.querySelectorAll('.explore-grid .thumbnail');
                    const cleanedThumbnails = Array.from(originalThumbnails).filter(thumb => 
                        thumb.classList.contains('destroyed') || 
                        thumb.classList.contains('already-fallen') || 
                        thumb.style.visibility === 'hidden'
                    );
                    const thumbnailPercentage = originalThumbnails.length > 0 ? 
                        (cleanedThumbnails.length / originalThumbnails.length) * 100 : 100;
                    
                    // 기준선에서 청소한 비율만큼 감소
                    const cleaningProgress = thumbnailPercentage / 100; // 0~1
                    const overloadPercent = Math.round(cleaningModeStartPercent * (1 - cleaningProgress));
                    
                    const overloadPercentage = document.getElementById('overload-percentage');
                    const progressFill = document.getElementById('progress-fill');
                    if (overloadPercentage && progressFill) {
                        overloadPercentage.textContent = overloadPercent;
                        progressFill.style.width = overloadPercent + '%';
                    }
                } else {
                    updateCleaningSwitchVisibility();
                }
            }, 200);
        }
        
        function checkSidebarVisibility() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar || sidebar.classList.contains('cleaned')) return;
            
            const menuItems = sidebar.querySelectorAll('.menu a, .brand');
            console.log('사이드바 메뉴 개수:', menuItems.length);
            
            const allCleaned = Array.from(menuItems).every(item => {
                const isCleaned = item.classList.contains('cleaned') || item.classList.contains('destroyed');
                console.log('메뉴 항목:', item.textContent.trim(), 'cleaned:', isCleaned);
                return isCleaned;
            });
            
            console.log('모든 메뉴가 사라졌는가:', allCleaned);
            
            if (allCleaned) {
                console.log('사이드바 사라짐!');
                sidebar.classList.add('cleaned');
            }
        }
        
        function checkDetoxComplete() {
            const originalThumbnails = document.querySelectorAll('.explore-grid .thumbnail');
            const cleanedThumbnails = Array.from(originalThumbnails).filter(thumb => 
                thumb.classList.contains('destroyed') || 
                thumb.classList.contains('already-fallen') ||
                thumb.style.visibility === 'hidden'
            );
            const thumbnailPercentage = originalThumbnails.length > 0 ? 
                (cleanedThumbnails.length / originalThumbnails.length) * 100 : 100;
            const thumbnails95PercentGone = thumbnailPercentage >= 75;
            
            const sidebar = document.querySelector('.sidebar');
            const sidebarGone = !sidebar || sidebar.classList.contains('cleaned');
            
            const allWindows = document.querySelectorAll('.random-window');
            const cleanedWindows = Array.from(allWindows).filter(window => 
                window.classList.contains('cleaned') ||
                window.style.visibility === 'hidden'
            );
            const windowsPercentage = allWindows.length > 0 ? (cleanedWindows.length / allWindows.length) * 100 : 100;
            const allWindowsGone = windowsPercentage >= 50;
            
            console.log('DETOX 체크 (75% 이상):', {
                썸네일사라진비율: `${thumbnailPercentage.toFixed(1)}%`,
                썸네일75퍼센트이상: thumbnails95PercentGone,
                좌측메뉴: sidebarGone,
                팝업창80퍼센트이상: allWindowsGone,
                팝업창사라진비율: `${windowsPercentage.toFixed(1)}%`
            });
            
            if (thumbnails95PercentGone && sidebarGone && allWindowsGone) {
                setTimeout(() => {
                    const detoxMessage = document.getElementById('detox-complete');
                    if (detoxMessage) {
                        detoxMessage.classList.add('visible');
                    }
                }, 1000);
            }
        }
        
        function createGhostAndAnimate(originalElement) {
            const ghost = originalElement.cloneNode(true);
            
            ghost.classList.remove('destroyed', 'cleaned');
            
            const rect = originalElement.getBoundingClientRect();
            const computedStyle = getComputedStyle(originalElement);
            
            ghost.style.cssText = `
                position: fixed !important;
                left: ${rect.left}px !important;
                top: ${rect.top}px !important;
                width: ${rect.width}px !important;
                height: ${rect.height}px !important;
                z-index: 10000 !important;
                pointer-events: none !important;
                transform: none !important;
                opacity: 1 !important;
                animation: none !important;
                background: ${computedStyle.background} !important;
                border: ${computedStyle.border} !important;
                border-radius: ${computedStyle.borderRadius} !important;
                padding: ${computedStyle.padding} !important;
                margin: ${computedStyle.margin} !important;
                display: ${computedStyle.display} !important;
                align-items: ${computedStyle.alignItems} !important;
                justify-content: ${computedStyle.justifyContent} !important;
                gap: ${computedStyle.gap} !important;
                color: ${computedStyle.color} !important;
                font-family: ${computedStyle.fontFamily} !important;
                font-size: ${computedStyle.fontSize} !important;
                font-weight: ${computedStyle.fontWeight} !important;
                text-decoration: ${computedStyle.textDecoration} !important;
            `;
            
            document.body.appendChild(ghost);
            
            animateGhostToMouse(ghost, originalElement);
        }
        
        function animateGhostToMouse(ghost, originalElement) {
            const startTime = Date.now();
            const duration = 2000;
            
            const rect = originalElement.getBoundingClientRect();
            const startX = rect.left;
            const startY = rect.top;
            const startScale = 1;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const mouseX = window.mouseX || 0;
                const mouseY = window.mouseY || 0;
                
                const easeInOut = progress < 0.5 
                    ? 2 * progress * progress 
                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                
                const currentX = startX + (mouseX - startX) * easeInOut;
                const currentY = startY + (mouseY - startY) * easeInOut;
                
                const currentScale = startScale * (1 - easeInOut * 0.9);
                
                const currentOpacity = 1 - easeInOut;
                
                ghost.style.left = currentX + 'px';
                ghost.style.top = currentY + 'px';
                ghost.style.transform = `scale(${currentScale})`;
                ghost.style.opacity = currentOpacity;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    if(ghost.parentNode) {
                        ghost.remove();
                    }
                }
            }
            
            requestAnimationFrame(animate);
        }


        // 간단한 하단-바닥 충돌 + 감쇠만 적용(서로 충돌 제거로 튐 방지)
        function updateFallingThumbnails(){
            for(const t of fallingThumbnails){
                if(t.isStacked) continue;

                t.velocityY += GRAVITY;

                t.velocityX *= FRICTION;
                t.velocityY *= FRICTION;
                t.rotationSpeed *= FRICTION;

                t.velocityX = clamp(t.velocityX, -MAX_SPEED, MAX_SPEED);
                t.velocityY = clamp(t.velocityY, -MAX_SPEED, MAX_SPEED);

                t.x += t.velocityX;
                t.y += t.velocityY;

                t.rotation += t.rotationSpeed;

                if(t.x < 0){
                    t.x = 0;
                    t.velocityX = Math.abs(t.velocityX);
                }
                if(t.x + t.width > window.innerWidth){
                    t.x = window.innerWidth - t.width;
                    t.velocityX = -Math.abs(t.velocityX);
                }

                const localPile = getLocalPileHeight(t.x, t.width);
                const floorY = window.innerHeight - t.height - Math.max(pileHeight, localPile);
                if(t.y > floorY){
                    t.y = floorY;
                    t.velocityY = -t.velocityY * BOUNCE;
                    t.velocityX = (t.velocityX * 0.6) + (t.rollBias * 0.4);

                    if(Math.abs(t.velocityY) < MIN_VELOCITY && Math.abs(t.velocityX) < MIN_VELOCITY){
                        t.isStacked = true;
                        t.element.classList.remove('falling');
                        t.element.style.pointerEvents = 'auto';
                        t.element.style.zIndex = '5';
                        t.x += (Math.random()*2 - 1) * SETTLE_X_JITTER;
                        t.element.style.transform = 'rotate(0deg)';
                        stackedThumbnails.push(t);
                        pileHeight = Math.min(window.innerHeight * PILE_CAP, pileHeight + t.height * (PILE_GROWTH * 0.5));
                    }
                }

                t.element.style.left = t.x + 'px';
                t.element.style.top  = t.y + 'px';
                t.element.style.transform = `rotate(${t.rotation}deg)`;
            }

            fallingThumbnails = fallingThumbnails.filter(t => !t.isStacked);
        }

        function animate(){
            updateFallingThumbnails();
            requestAnimationFrame(animate);
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            init();
            animate();
        });
    </script>
</body>
</html>
